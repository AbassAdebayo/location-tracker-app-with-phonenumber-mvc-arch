{% extends 'base.html' %}

{% block content %}
<h2>Track Result</h2>
{% if data %}
    <p><strong>Phone Number:</strong> {{ data.phone }}</p>
    <p><strong>Location:</strong> {{ data.detailed_location }}</p>
    <p><strong>Latitude:</strong> {{ data.latitude }}</p>
    <p><strong>Longitude:</strong> {{ data.longitude }}</p>
    <p><strong>Carrier:</strong> {{ data.carrier }}</p>
    <p><strong>Line Type:</strong> {{ data.type }}</p>

    <!-- Embed Leaflet Map -->
    <div id="map" style="height: 400px; width: 100%;"></div>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var map = L.map('map').setView([{{ data.latitude }}, {{ data.longitude }}], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            L.marker([{{ data.latitude }}, {{ data.longitude }}]).addTo(map)
                .bindPopup('Location')
                .openPopup();

            // Hide the loading animation
            document.getElementById('loading-animation').style.display = 'none';

            // Show the tracking alert
            const alertContainer = document.createElement('div');
            alertContainer.id = 'tracking-alert';
            alertContainer.innerText = 'Tracking Complete!';
            document.body.appendChild(alertContainer);

            const alertSound = new Audio('https://www.soundjay.com/button/beep-07.wav');
            alertSound.play();

            
            const alertStyle = document.createElement('style');
            alertStyle.innerHTML = `
                #tracking-alert {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: yellow;
                    color: red;
                    font-size: 3em;
                    padding: 20px;
                    border: 2px solid red;
                    z-index: 5;
                }
            `;
            document.head.appendChild(alertStyle);
        });
    </script>
{% else %}
    <p>No data available.</p>
{% endif %}
<a href="{% url 'track' %}">Track another</a>
{% endblock %}
